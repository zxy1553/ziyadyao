# 第五页：知识库设计——从"能做"到"做对"

---

## 页面主题
> Skill 教会了 Agent "怎么做"，知识库告诉它"知道什么"

---

## 一、承接上页：Skill 的遗留问题

| 场景 | 问题现象 | 根因 |
|------|----------|------|
| Dev | API 混淆：`GetOwningPawn` / `GetSelfActor` / `GetSelf` | 不知道"用什么" |
| Dev | 混淆 Actor 函数 vs Library 函数 | 不知道"怎么用" |
| Debug | 误判 Status Refresh 为异常 | 不了解"项目机制" |
| Debug | 分析错误角色、错误时间段 | 没有"固定流程" |

---

## 二、Why Knowledge：为什么需要知识库？

### 2.1 现有检索方案对比

| 方案 | 精度 | 速度 | 局限 |
|------|------|------|------|
| 源码搜索 | 低 | 慢 | 量大、看不出设计意图 |
| Codebase Search | 中 | 中 | 只能搜到"有什么"，搜不到"怎么用" |
| **Knowledge** | **高** | **快** | **精准、结构化、可迭代** |

### 2.2 知识库能补充什么？

| 维度 | Codebase Search | Knowledge 补充 |
|------|-----------------|----------------|
| API 检索 | 找到 API 在哪 | **怎么用、什么场景用** |
| 最佳实践 | ❌ | ✅ 已有类似实现参考 |
| 经验沉淀 | ❌ | ✅ Debug 案例复用 |
| 设计意图 | ❌ | ✅ 清晰的架构说明 |

---

## 三、知识库架构设计

### 3.1 分层架构图

```
                     ┌──────────────────┐
                     │  _index.md 入口   │
                     └────────┬─────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        ▼                     ▼                     ▼
┌───────────────┐    ┌───────────────┐    ┌─────────────────┐
│ domain_context│    │domain_agreements│   │    _memory/     │
│ (战斗系统背景) │    │ (开发通用约定)  │   │ 实体/模式/时序   │
└───────────────┘    └───────────────┘    └─────────────────┘
                              │
                     ┌────────┴────────┐
                     ▼                 ▼
              ┌─────────────┐   ┌─────────────┐
              │ Concepts/   │   │   Debug/    │
              │ 架构设计文档 │   │ 案例+方法论 │
              └──────┬──────┘   └─────────────┘
                     │
     ┌───────┬───────┼───────┬───────┐
     ▼       ▼       ▼       ▼       ▼
  Core/  Effect/ Targeting/ Cue/  Equipment/
  核心    效果     目标     表现    装备
```

### 3.2 模块标准结构

```
模块/
├── API/       # API 文档 (JSON)
├── Logs/      # 日志解读 (JSON)
└── impl.json  # 源码路径索引
```

---

## 四、设计思考（用事实说话）

### 思考1：知识库放什么？
- ❌ 不放代码（Agent 本来就能搜）
- ✅ 放 Agent 的盲区：API 用法、日志含义、Debug 经验

### 思考2：文档格式怎么选？
- ❌ Markdown → Agent 解析困难，漏关键字段
- ✅ JSON → 结构化，精准检索

```json
{
  "function": "GetAbilitySystemComponentFromActor",
  "usage": "从任意 Actor 获取 ASC",
  "vs": "GetAbilitySystemComponent 是 Actor 成员函数",
  "when_to_use": "持有 Actor 引用而非 ASC 持有者时"
}
```

### 思考3：怎么保持更新？
- 制作 **维护工具 Skill**：自动扫描代码 → 生成文档 → 检测差异

---

## 五、实际效果对比

### Case 1：API 混淆问题

| 没有知识库 | 有知识库 |
|------------|----------|
| 搜代码 → 用 `GetAbilitySystemComponent` | 检索知识库 |
| 编译报错 → 试其他 API → 还是错 | 返回正确用法 → 一次正确 |

### Case 2：Debug 误判问题

| 没有知识库 | 有知识库 |
|------------|----------|
| 看到 `Status Added → Removed → Added` | 检索知识库 |
| 判断："这是 Bug！" | 返回："Status Refresh 是正常机制" |
| 分析方向错误 | 继续排查真正问题 |

### Case 3：案例复用（边际效益）

| 第一次排查 | 第 N 次排查 |
|------------|-------------|
| 从零分析，2 小时 | 检索相似案例 |
| 记录修复过程 | 参考方案，15 分钟定位 |

---

## 演讲要点

1. **承接**：Skill 解决了流程，但 Agent 还是会犯错（API 混淆、误判）
2. **Why**：对比检索方案，知识库补充 Agent 盲区
3. **What**：展示分层架构 + 设计思考
4. **效果**：3 个真实 Case 证明价值
